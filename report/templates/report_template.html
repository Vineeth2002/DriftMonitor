<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DriftMonitor – AI Safety Evaluation Report</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>

<body>
    <div class="container">
        <h1>DriftMonitor – AI Safety Evaluation</h1>
        <p class="timestamp">Generated at: {{ timestamp }}</p>

        <!-- Summary section (counts) -->
        {% if summary %}
        <section class="summary">
            <h2>Daily Summary</h2>
            <p>Total texts evaluated: <strong>{{ summary.n_texts }}</strong></p>
            <div class="counts">
                <h3>Sentiment counts</h3>
                <ul>
                {% for label, count in summary.label_counts.items() %}
                    <li><strong>{{ label }}</strong>: {{ count }}</li>
                {% endfor %}
                </ul>
            </div>
            <div class="risky">
                <h3>Risk summary</h3>
                <p>Safety threshold: {{ summary.safety_threshold }}</p>
                <p>Number of risky items (safety_score &lt; threshold): <strong>{{ summary.n_risky }}</strong></p>
                {% if summary.risky_examples %}
                <h4>Top risky examples</h4>
                <ol>
                    {% for r in summary.risky_examples %}
                    <li>
                        <div class="risk-text">{{ r.text }}</div>
                        <div class="risk-meta">score: {{ "%.3f"|format(r.safety_score) }} — {{ r.reason }}</div>
                    </li>
                    {% endfor %}
                </ol>
                {% endif %}
            </div>
        </section>
        {% else %}
          <p><em>No evaluation summary available yet.</em></p>
        {% endif %}

        <!-- Drift summary (if available) -->
        {% if drift_summary %}
        <section class="drift-summary">
            <h2>Drift Summary (latest)</h2>
            <p>Compared files: <strong>{{ drift_summary.eval_a }}</strong> vs <strong>{{ drift_summary.eval_b }}</strong></p>
            <p><strong>Jensen–Shannon Divergence (normalized)</strong>: {{ "%.4f"|format(drift_summary.drift.jsd) }}</p>
        </section>
        {% endif %}

        <!-- Full safety results preview -->
        <h2>Safety Results (preview)</h2>
        <table>
            <thead>
                <tr>
                    <th>Text (preview)</th>
                    <th>Sentiment</th>
                    <th>Toxicity</th>
                    <th>Safety Score</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                {% for item in eval.safety_results %}
                <tr>
                    <td class="text-preview">{{ item.text[:120] }}{% if item.text|length > 120 %}...{% endif %}</td>
                    <td>{{ item.sentiment_label }} <span class="muted">({{ "%.2f"|format(item.sentiment_score) }})</span></td>
                    <td>{{ "%.2f"|format(item.toxicity_score) }}</td>
                    <td>{{ "%.3f"|format(item.safety_score) }}</td>
                    <td class="reason">{{ item.reason }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <p class="footer">DriftMonitor – AI Drift & Safety Monitoring System</p>
    </div>
</body>
</html>
